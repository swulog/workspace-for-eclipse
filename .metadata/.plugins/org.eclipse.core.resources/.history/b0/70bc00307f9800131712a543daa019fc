package com.ivorytower.app.service.impl;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

import com.ivorytower.app.dto.QryPostsListDto;
import com.ivorytower.app.entity.Postlistinfo;
import com.ivorytower.app.entity.Userbaseinfo;
import com.ivorytower.app.service.PostService;
import com.ivorytower.comm.Result;

@Service("postservice")
public class PostServiceImpl extends BaseServiceImpl implements PostService {

	@SuppressWarnings("unchecked")
	@Override
	public void findPostList(QryPostsListDto dto,Result result) {
		
		if(dto.getPostTypeId()<=0) {
			result.setSuccess(false);
			result.setMsg("没有帖子类型");
			return;
		}
		
		// TODO Auto-generated method stub
		
		StringBuilder sb=new StringBuilder();
		sb.append("select pli.*,uei.uei_nickname,uei.uei_sex,uei.uei_age,uei.uei_level,uei.uei_avatar from PostListInfo pli,UserExpandInfo uei where 1=1 and pli.pli_userid = uei.uei_id ");
		sb.append(" and pli.pli_ptiid = " + dto.getPostTypeId());
		sb.append(" limit " + (dto.getPageNo()-1)*dto.getPageSize() + "," + dto.getPageSize());
 System.out.println("----" + sb.toString());
		List<Postlistinfo> list = (List<Postlistinfo>)this.getBaseDao().findByHql(sb.toString());
		List<Object> listData=new ArrayList<Object>();
		if (list.size() > 0) {
			for (int i=0;i<list.size();i++) {
				Map<Object,Object> mapData=new HashMap<Object,Object>();
				mapData.put("content", list.get(i).getPliContent());
				mapData.put("createtime", list.get(i).getPliCreatetime());
				mapData.put("pid", list.get(i).getPliId());
				mapData.put("istop", list.get(i).getPliIstop());
				mapData.put("pttid", list.get(i).getPliPtiid());
				mapData.put("replynum", list.get(i).getPliReplynum());
				mapData.put("reportnum", list.get(i).getPliReportnum());
				mapData.put("status", list.get(i).getPliStatus());
				mapData.put("title", list.get(i).getPliTitle());
				mapData.put("userid", list.get(i).getPliUserid());
				listData.add(mapData);
			}
		}
		result.getData().put("list", listData);
		result.setMsg("成功");
	}

}
